// Copyright (c) 2012 Ankur Agarwal <ankur@debuggify.net>

// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:

// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.

/*! Socket.IO.js build:0.9.9, development. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
   * Parses an URI
   *
   * @author Steven Levithan <stevenlevithan.com> (MIT license)
   * @api public
   */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

function printStackTrace(options){options=options||{guess:!0};var ex=options.e||null,guess=!!options.guess,p=new printStackTrace.implementation,result=p.run(ex);return guess?p.guessAnonymousFunctions(result):result}(function(global,w,undefined){var debuggify=global.debuggify=global.debuggify||function(){function extend(options,defaults){var i;for(i in defaults)defaults.hasOwnProperty(i)&&typeof options[i]=="undefined"&&(options[i]=defaults[i]);return options}var version="0.0.1",globals={projects:{},namespaces:{},transports:{},delimiter:"__",selfLogger:null};return{win:w,doc:w.document,console:w.console||null,extend:extend,globals:globals,envs:{},version:version}}()})(this,window),function(envs){envs.defaults={apikey:null,logger:{optimize:!1,collector:!0,history:!0,timestamp:!0,level:0,flagPrefix:"__",functionPrefix:"",messagesTypes:{log:0,info:1,warn:2,error:3},transports:{Console:{},Websockets:{prefix:"debuggify",publish:"logger",subscribe:null}}},messageFormat:"",compiledTemplate:!1,transports:{Console:{},Websockets:{prefix:"debuggify",publish:null,subscribe:null}}}}(debuggify.envs),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(ex,mode){return ex=ex||this.createException(),mode=mode||this.mode(ex),mode==="other"?this.other(arguments.callee):this[mode](ex)},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){return e.arguments&&e.stack?"chrome":typeof e.message=="string"&&typeof window!="undefined"&&window.opera?e.stacktrace?e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?"opera9":e.stack?e.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":"opera10a":"opera9":e.stack?"firefox":"other"},instrumentFunction:function(context,functionName,callback){context=context||window;var original=context[functionName];context[functionName]=function(){return callback.call(this,printStackTrace().slice(4)),context[functionName]._instrumented.apply(this,arguments)},context[functionName]._instrumented=original},deinstrumentFunction:function(context,functionName){context[functionName].constructor===Function&&context[functionName]._instrumented&&context[functionName]._instrumented.constructor===Function&&(context[functionName]=context[functionName]._instrumented)},chrome:function(e){var stack=(e.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return stack.pop(),stack},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(e){var ANON="{anonymous}",lineRE=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){var location=match[4]+":"+match[1]+":"+match[2],fnName=match[3]||"global code";fnName=fnName.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,ANON),result.push(fnName+"@"+location+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},opera10b:function(e){var lineRE=/^(.*)@(.+):(\d+)$/,lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i++){var match=lineRE.exec(lines[i]);if(match){var fnName=match[1]?match[1]+"()":"global code";result.push(fnName+"@"+match[2]+":"+match[3])}}return result},opera10a:function(e){var ANON="{anonymous}",lineRE=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){var fnName=match[3]||ANON;result.push(fnName+"()@"+match[2]+":"+match[1]+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},opera9:function(e){var ANON="{anonymous}",lineRE=/Line (\d+).*script (?:in )?(\S+)/i,lines=e.message.split("\n"),result=[];for(var i=2,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);match&&result.push(ANON+"()@"+match[2]+":"+match[1]+" -- "+lines[i+1].replace(/^\s+/,""))}return result},other:function(curr){var ANON="{anonymous}",fnRE=/function\s*([\w\-$]+)?\s*\(/i,stack=[],fn,args,maxStackSize=10;while(curr&&curr.arguments&&stack.length<maxStackSize)fn=fnRE.test(curr.toString())?RegExp.$1||ANON:ANON,args=Array.prototype.slice.call(curr.arguments||[]),stack[stack.length]=fn+"("+this.stringifyArguments(args)+")",curr=curr.caller;return stack},stringifyArguments:function(args){var result=[],slice=Array.prototype.slice;for(var i=0;i<args.length;++i){var arg=args[i];arg===undefined?result[i]="undefined":arg===null?result[i]="null":arg.constructor&&(arg.constructor===Array?arg.length<3?result[i]="["+this.stringifyArguments(arg)+"]":result[i]="["+this.stringifyArguments(slice.call(arg,0,1))+"..."+this.stringifyArguments(slice.call(arg,-1))+"]":arg.constructor===Object?result[i]="#object":arg.constructor===Function?result[i]="#function":arg.constructor===String?result[i]='"'+arg+'"':arg.constructor===Number&&(result[i]=arg))}return result.join(",")},sourceCache:{},ajax:function(url){var req=this.createXMLHTTPObject();if(req)try{return req.open("GET",url,!1),req.send(null),req.responseText}catch(e){}return""},createXMLHTTPObject:function(){var xmlhttp,XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var i=0;i<XMLHttpFactories.length;i++)try{return xmlhttp=XMLHttpFactories[i](),this.createXMLHTTPObject=XMLHttpFactories[i],xmlhttp}catch(e){}},isSameDomain:function(url){return typeof location!="undefined"&&url.indexOf(location.hostname)!==-1},getSource:function(url){return url in this.sourceCache||(this.sourceCache[url]=this.ajax(url).split("\n")),this.sourceCache[url]},guessAnonymousFunctions:function(stack){for(var i=0;i<stack.length;++i){var reStack=/\{anonymous\}\(.*\)@(.*)/,reRef=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,frame=stack[i],ref=reStack.exec(frame);if(ref){var m=reRef.exec(ref[1]);if(m){var file=m[1],lineno=m[2],charno=m[3]||0;if(file&&this.isSameDomain(file)&&lineno){var functionName=this.guessAnonymousFunction(file,lineno,charno);stack[i]=frame.replace("{anonymous}",functionName)}}}}return stack},guessAnonymousFunction:function(url,lineNo,charNo){var ret;try{ret=this.findFunctionName(this.getSource(url),lineNo)}catch(e){ret="getSource failed with url: "+url+", exception: "+e.toString()}return ret},findFunctionName:function(source,lineNo){var reFunctionDeclaration=/function\s+([^(]*?)\s*\(([^)]*)\)/,reFunctionExpression=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,reFunctionEvaluation=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,code="",line,maxLines=Math.min(lineNo,20),m,commentPos;for(var i=0;i<maxLines;++i){line=source[lineNo-i-1],commentPos=line.indexOf("//"),commentPos>=0&&(line=line.substr(0,commentPos));if(line){code=line+code,m=reFunctionExpression.exec(code);if(m&&m[1])return m[1];m=reFunctionDeclaration.exec(code);if(m&&m[1])return m[1];m=reFunctionEvaluation.exec(code);if(m&&m[1])return m[1]}}return"(?)"}},function(debuggify,undefined){var utils=debuggify.Utils=debuggify.Utils||function(){function processTemplate(str,data){var caller=processTemplate;return caller.cache=caller.cache||{},caller.tmpl=caller.tmpl||function(str,data){var fn=/\W/.test(str)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):caller.cache[str]=caller.cache[str]||caller.tmpl(doc.getElementById(str).innerHTML);return data?fn(data):fn},caller.tmpl(str,data)}function queryString(url){try{var q=url.split("?")[1],a=q.split("&");if(a==="")return{};var i,b={};for(i=0;i<a.length;i+=1)try{var p=a[i].split("=");if(p.length!==2)throw"continue";b[p[0]]=decodeURIComponent(p[1].replace(/\+/g," "))}catch(e){}return b}catch(err){return{}}}function getStackTrace(){if(win.printStackTrace)return win.printStackTrace.apply(this,arguments)}var win=window,doc=win.document;return{processTemplate:processTemplate,queryString:queryString,getStackTrace:getStackTrace}}()}(debuggify),function(debuggify,undefined){var logger=debuggify.Logger=debuggify.Logger||function(w,d,extend,utils,globals,envs){function Logger(name,environments,options){this.initialize(name,environments,options)}function getFileInfo(frame){try{var m=fileInfoRegex.exec(frame);if(m)return{file:m[1],fileName:m[1].substr(m[1].lastIndexOf("/")+1),lineNo:m[2],charNo:m[3]}}catch(e){return!1}}function genericMessage(messageArray,type){var self=this,stack=utils.getStackTrace(self.options.optimize?{}:{guess:!0}),elNo=2,stackLength=stack.length,stackElement;while(elNo<=stackLength){stackElement=stack[elNo];if(stackRegex.test(stackElement)){elNo+=2;break}elNo+=1}var appStack=stack.slice(elNo),info=getFileInfo(appStack[0])||{};info.type=type,info.name=self.name,info.namespace=self.namespace,info.stack=appStack,info.timestamp=new Date,self.sendToCollector([type,messageArray,info])}function getFunc(type,options){return options.optimize?emptyFunction:function(){var namespace=this.namespace,options=this.options;typeof flags_[namespace][options.flagPrefix+type]!="undefined"&&flags_[namespace][options.flagPrefix+type]&&flags_[namespace][options.flagPrefix+type]!=="false"&&this.genericMessage(arguments,type)}}function getAllEnvironments(key){var e={},prop;for(prop in envs)envs.hasOwnProperty(prop)&&typeof envs[prop][key]!="undefined"?e[prop]=envs[prop][key]:e[key]={};return e}function installFunctions(context,options){var type,types=options.messagesTypes;for(type in types)types.hasOwnProperty(type)&&types[type]>=options.level?context[options.functionPrefix+type]=getFunc(type,options):context[options.functionPrefix+type]=emptyFunction}function installFlags(context,namespace){var options=context.options,type,types=options.messagesTypes;flags_[namespace]=flags_[namespace]||{};for(type in types)flags_[namespace][options.flagPrefix+type]=getFirstDefinedValue(urlParameters[namespace+globals.delimiter+type],urlParameters[namespace],urlParameters[type],types[type]>=options.level)}function getFirstDefinedValue(){var i,l=arguments.length;for(i=0;i<l;i+=1)if(typeof arguments[i]!="undefined")return arguments[i]}function extendEnvironments(environments,returnEmpty){if(typeof environments=="undefined")return!1;var env={},envs_=getAllEnvironments("logger"),defaults=typeof environments.defaults!="undefined"?extend(environments.defaults,envs_.defaults):envs_.defaults,i,count=0;for(i in environments)environments.hasOwnProperty(i)&&(typeof envs_[i]=="undefined"?envs_[i]=extend(environments[i],defaults):env[i]=extend(extend(environments[i],envs_[i]),defaults)),count+=1;return typeof returnEmpty!="undefined"&&returnEmpty===!0&&count===0?!1:env}function project(name,environments){function Project(name){this.modules={},this.collectorQueue=[],this.transports=[]}if(typeof name=="undefined")throw"No name defined";typeof environments=="undefined"&&(environments={defaults:{}});var env=extendEnvironments(environments);Project.prototype=new Logger(name,env,{}),installFunctions(Project.prototype,Project.prototype.options);var project=new Project(name);return globals.namespaces[project.namespace]=project,globals.projects[project.name]=project,installUrlOptions(project),installFlags(project,project.namespace),installTransports(project),project.genericMessage([project.name,project.namespace,project.options,!1],"_addProject"),debuggify&&debuggify.Collector&&debuggify.Collector.process&&debuggify.Collector.process(),project}function installTransports(project){var transports=project.options.transports;for(var transport in transports)project.addTransport(transport,transports[transport])}function checkForBoolean(obj){var prop,value;for(prop in obj)if(obj.hasOwnProperty(prop)){value=obj[prop];switch(value.toLowerCase()){case"true":obj[prop]=!0;break;case"false":obj[prop]=!1;break;default:}}return obj}function installUrlOptions(context){try{urlParameters=urlParameters||checkForBoolean(utils.queryString(d.location.href));var prefix=context.namespace;if(urlParameters&&typeof urlParameters[prefix+globals.delimiter+"debug"]!="undefined"){typeof urlParameters.env!="undefined"&&context.setEnv(urlParameters.env);var property,options={},count=0,temp;for(property in context.options)temp=prefix+globals.delimiter+property,context.options.hasOwnProperty(property)&&typeof urlParameters[temp]!="undefined"&&(options[property]=urlParameters[temp],count+=1);count>0&&(context.options=extend(options,context.options))}}catch(e){genericMessage(["something went wrong"+e],"error")}}function registerForErrors(){var fe=w.onerror;w.onerror=function(message,file,lineNo,e){var info={type:"error",lineNo:lineNo,file:file,fileName:file.substr(file.lastIndexOf("/")+1)||"",charNo:null,name:selfLogger.name,namespace:globals.selfLogger.namespace,stack:null};return typeof message=="undefined"&&(message="No message"),selfLogger.sendToCollector(["error",[message],info]),fe&&typeof fe=="function"&&fe.apply(this,arguments),!1}}function getProject(name,createNew){return typeof globals.projects[name]!="undefined"?globals.projects[name]:typeof createNew!="undefined"&&createNew===!1?!1:project(name)}function getByNamespace(namespace){return globals.namespaces[namespace]||!1}var stackRegex=/Object.genericMessage/,fileInfoRegex=/\((.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?\)$/,urlParameters,flags_={},emptyFunction=function(){};Logger.prototype={setEnv:function(environmentName){var env=this.environments;if(typeof env=="undefined"||typeof env[environmentName]=="undefined")throw"Invalid environment name "+environmentName+" for project "+this.name;this.options=extend(env[environmentName],{}),this.env=environmentName},initialize:function(name,environments,options){var self=this;self.name=name,self.isLogger=!0,self._childrens={},self.history=[],environments&&(self.environments=environments,self.options=options,self.setEnv("defaults")),self.setNamespace()},setLevel:function(level){return level=parseInt(level,10),typeof level!="number"||isNaN(level)?!1:(this.options.level=level,installFunctions(this,this.options),!0)},setFlag:function(type,value){return flags_[this.namespace]&&typeof flags_[this.namespace][this.options.flagPrefix+type]!="undefined"?(flags_[this.namespace][this.options.flagPrefix+type]=value,!0):!1},addModule:function(name,environments,parent){try{if(typeof name!="string"||name==="")throw"Invalid name";typeof environments=="undefined"&&(environments={defaults:{}}),typeof parent=="undefined"&&(parent=this);if(typeof this.modules[name]!="undefined")throw"Module "+name+" already initialized";environments=extendEnvironments(environments,!0);function Module(){}Module.prototype=parent;var module=new Module;return module.initialize(name,environments,extend(extend({},this.options),environments)),parent._childrens[name]=module,module.parent=parent,globals.namespaces[module.namespace]=module,installFlags(module,module.namespace),parent.modules[module.name]=module,module.genericMessage([module.name,module.namespace,module.options,parent.namespace],"_addModule"),module}catch(e){return selfLogger.message(["Cannot add module name"+name+"due to error:"+e],"logger","error"),!1}},get:function(name,createNew){return typeof this.modules[name]!="undefined"?this.modules[name]:typeof createNew!="undefined"&&createNew===!1?!1:this.addModule(name,{})},message:function(message,moduleName,type){this.get(moduleName).genericMessage([message],type)},setNamespace:function(){this.namespace?this.namespace=this.namespace+globals.delimiter+this.name:this.namespace=this.name},addTransport:function(transportName,options){this.genericMessage([transportName,options],"_addTransport")},sendToCollector:function(data){var self=this,options=self.options;data[2].location=d.location.href,options.collector&&self.collectorQueue.push(data),!options.optimize&&options.history&&self.history.push(data)},genericMessage:genericMessage};var selfLogger=globals.selfLogger=project("debuggify");return selfLogger.genericMessage([],"_init"),registerForErrors(),{create:project,get:getProject,getByNamespace:getByNamespace}}(debuggify.win,debuggify.doc,debuggify.extend,debuggify.Utils,debuggify.globals,debuggify.envs)}(debuggify),function(debuggify,undefined){var transports=debuggify.Transports=debuggify.Transports||function(w,d,extend,globals){function Transports(name){this.name=name,typeof globals.transports[name]=="undefined"&&(globals.transports[name]={})}return Transports.prototype={initialize:function(level,timestamp){this.level=level,this.timestamp=timestamp},setLevel:function(level){this.level=level},send:function(){throw"Send is Not Implemented for transport"+this.name}},Transports}(debuggify.win,debuggify.doc,debuggify.extend,debuggify.globals)}(debuggify),function(debuggify,undefined){var collector=debuggify.Collector=debuggify.Collector||function(w,d,extend,globals,transports,envs){function isArray(obj){return toString.call(obj)==="[object Array]"}function deleteArray(arr){arr.splice(0,arr.length)}function init(){processProjects()}function processProjects(){var project,projectList=globals.projects;for(project in projectList)projectList.hasOwnProperty(project)&&processQueue(projectList[project])}function processQueue(project){var queue=project.collectorQueue=project.collectorQueue||[];if(typeof queue.isCollector!="undefined")return!1;if(!isArray(queue))throw"Queue must be array";var l=queue.length;for(var i=0;i<l;i++)processCmd(queue[i],project);deleteArray(queue),project.collectorQueue=new Collector(project)}function processCmd(cmd,self){if(!isArray(cmd))throw globals.selfLogger.log(cmd),"Expecting array, got "+typeof cmd;var func=cmd[0],args=Array.prototype.slice.call(cmd,1);if(func[0]==="_"&&typeof funcs[func]=="function")funcs[func].apply(self,args[0]);else{var l=self.transports.length,transport;for(transport in self.transports)if(self.transports.hasOwnProperty(transport)){var t=self.transports[transport];try{var level=self.options.messagesTypes[args[1].type];(typeof level=="undefined"||t.options.level<=level)&&t.send.apply(self.transports[transport],args)}catch(e){globals.selfLogger.warn(t.name+": Sending via transport failed: "+e)}}}}function Collector(project){this.isCollector=!0,this.project=project}var funcs={_addTransport:function(transportName,options){globals.transports[transportName]&&transports[transportName]?this.transports.push(new transports[transportName](options)):globals.selfLogger.warn("transport "+transportName+" is not defined")}},toString=Object.prototype.toString;return Collector.prototype={push:function(cmd){return processCmd(cmd,this.project)}},{init:init,process:processProjects}}(debuggify.win,debuggify.doc,debuggify.extend,debuggify.globals,debuggify.Transports,debuggify.envs);collector.init()}(debuggify);var io="undefined"==typeof module?{}:module.exports;(function(){(function(exports,global){var io=exports;io.version="0.9.9",io.protocol=1,io.transports=[],io.j=[],io.sockets={},io.connect=function(host,details){var uri=io.util.parseUri(host),uuri,socket;global&&global.location&&(uri.protocol=uri.protocol||global.location.protocol.slice(0,-1),uri.host=uri.host||(global.document?global.document.domain:global.location.hostname),uri.port=uri.port||global.location.port),uuri=io.util.uniqueUri(uri);var options={host:uri.host,secure:"https"==uri.protocol,port:uri.port||("https"==uri.protocol?443:80),query:uri.query||""};io.util.merge(options,details);if(options["force new connection"]||!io.sockets[uuri])socket=new io.Socket(options);return!options["force new connection"]&&socket&&(io.sockets[uuri]=socket),socket=socket||io.sockets[uuri],socket.of(uri.path.length>1?uri.path:"")}})("object"==typeof module?module.exports:this.io={},this),function(exports,global){var util=exports.util={},re=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];util.parseUri=function(str){var m=re.exec(str||""),uri={},i=14;while(i--)uri[parts[i]]=m[i]||"";return uri},util.uniqueUri=function(uri){var protocol=uri.protocol,host=uri.host,port=uri.port;return"document"in global?(host=host||document.domain,port=port||(protocol=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(host=host||"localhost",!port&&protocol=="https"&&(port=443)),(protocol||"http")+"://"+host+":"+(port||80)},util.query=function(base,addition){var query=util.chunkQuery(base||""),components=[];util.merge(query,util.chunkQuery(addition||""));for(var part in query)query.hasOwnProperty(part)&&components.push(part+"="+query[part]);return components.length?"?"+components.join("&"):""},util.chunkQuery=function(qs){var query={},params=qs.split("&"),i=0,l=params.length,kv;for(;i<l;++i)kv=params[i].split("="),kv[0]&&(query[kv[0]]=kv[1]);return query};var pageLoaded=!1;util.load=function(fn){if("document"in global&&document.readyState==="complete"||pageLoaded)return fn();util.on(global,"load",fn,!1)},util.on=function(element,event,fn,capture){element.attachEvent?element.attachEvent("on"+event,fn):element.addEventListener&&element.addEventListener(event,fn,capture)},util.request=function(xdomain){if(xdomain&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!xdomain||util.ua.hasCORS))return new XMLHttpRequest;if(!xdomain)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&util.load(function(){pageLoaded=!0}),util.defer=function(fn){if(!util.ua.webkit||"undefined"!=typeof importScripts)return fn();util.load(function(){setTimeout(fn,100)})},util.merge=function(target,additional,deep,lastseen){var seen=lastseen||[],depth=typeof deep=="undefined"?2:deep,prop;for(prop in additional)additional.hasOwnProperty(prop)&&util.indexOf(seen,prop)<0&&(typeof target[prop]!="object"||!depth?(target[prop]=additional[prop],seen.push(additional[prop])):util.merge(target[prop],additional[prop],depth-1,seen));return target},util.mixin=function(ctor,ctor2){util.merge(ctor.prototype,ctor2.prototype)},util.inherit=function(ctor,ctor2){function f(){}f.prototype=ctor2.prototype,ctor.prototype=new f},util.isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"},util.intersect=function(arr,arr2){var ret=[],longest=arr.length>arr2.length?arr:arr2,shortest=arr.length>arr2.length?arr2:arr;for(var i=0,l=shortest.length;i<l;i++)~util.indexOf(longest,shortest[i])&&ret.push(shortest[i]);return ret},util.indexOf=function(arr,o,i){for(var j=arr.length,i=i<0?i+j<0?0:i+j:i||0;i<j&&arr[i]!==o;i++);return j<=i?-1:i},util.toArray=function(enu){var arr=[];for(var i=0,l=enu.length;i<l;i++)arr.push(enu[i]);return arr},util.ua={},util.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(e){return!1}return a.withCredentials!=undefined}(),util.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),util.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(exports,io){function EventEmitter(){}exports.EventEmitter=EventEmitter,EventEmitter.prototype.on=function(name,fn){return this.$events||(this.$events={}),this.$events[name]?io.util.isArray(this.$events[name])?this.$events[name].push(fn):this.$events[name]=[this.$events[name],fn]:this.$events[name]=fn,this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.once=function(name,fn){function on(){self.removeListener(name,on),fn.apply(this,arguments)}var self=this;return on.listener=fn,this.on(name,on),this},EventEmitter.prototype.removeListener=function(name,fn){if(this.$events&&this.$events[name]){var list=this.$events[name];if(io.util.isArray(list)){var pos=-1;for(var i=0,l=list.length;i<l;i++)if(list[i]===fn||list[i].listener&&list[i].listener===fn){pos=i;break}if(pos<0)return this;list.splice(pos,1),list.length||delete this.$events[name]}else(list===fn||list.listener&&list.listener===fn)&&delete this.$events[name]}return this},EventEmitter.prototype.removeAllListeners=function(name){return this.$events&&this.$events[name]&&(this.$events[name]=null),this},EventEmitter.prototype.listeners=function(name){return this.$events||(this.$events={}),this.$events[name]||(this.$events[name]=[]),io.util.isArray(this.$events[name])||(this.$events[name]=[this.$events[name]]),this.$events[name]},EventEmitter.prototype.emit=function(name){if(!this.$events)return!1;var handler=this.$events[name];if(!handler)return!1;var args=Array.prototype.slice.call(arguments,1);if("function"==typeof handler)handler.apply(this,args);else{if(!io.util.isArray(handler))return!1;var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++)listeners[i].apply(this,args)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(n){return n<10?"0"+n:n}function date(d,key){return isFinite(d.valueOf())?d.getUTCFullYear()+"-"+f(d.getUTCMonth()+1)+"-"+f(d.getUTCDate())+"T"+f(d.getUTCHours())+":"+f(d.getUTCMinutes())+":"+f(d.getUTCSeconds())+"Z":null}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c=="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];value instanceof Date&&(value=date(key)),typeof rep=="function"&&(value=rep.call(holder,key,value));switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";gap+=indent,partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&typeof rep=="object"){length=rep.length;for(i=0;i<length;i+=1)typeof rep[i]=="string"&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))}else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(value,replacer,space){var i;gap="",indent="";if(typeof space=="number")for(i=0;i<space;i+=1)indent+=" ";else typeof space=="string"&&(indent=space);rep=replacer;if(!replacer||typeof replacer=="function"||typeof replacer=="object"&&typeof replacer.length=="number")return str("",{"":value});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value=="object")for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),v!==undefined?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined),function(exports,io){var parser=exports.parser={},packets=parser.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],reasons=parser.reasons=["transport not supported","client not handshaken","unauthorized"],advice=parser.advice=["reconnect"],JSON=io.JSON,indexOf=io.util.indexOf;parser.encodePacket=function(packet){var type=indexOf(packets,packet.type),id=packet.id||"",endpoint=packet.endpoint||"",ack=packet.ack,data=null;switch(packet.type){case"error":var reason=packet.reason?indexOf(reasons,packet.reason):"",adv=packet.advice?indexOf(advice,packet.advice):"";if(reason!==""||adv!=="")data=reason+(adv!==""?"+"+adv:"");break;case"message":packet.data!==""&&(data=packet.data);break;case"event":var ev={name:packet.name};packet.args&&packet.args.length&&(ev.args=packet.args),data=JSON.stringify(ev);break;case"json":data=JSON.stringify(packet.data);break;case"connect":packet.qs&&(data=packet.qs);break;case"ack":data=packet.ackId+(packet.args&&packet.args.length?"+"+JSON.stringify(packet.args):"")}var encoded=[type,id+(ack=="data"?"+":""),endpoint];return data!==null&&data!==undefined&&encoded.push(data),encoded.join(":")},parser.encodePayload=function(packets){var decoded="";if(packets.length==1)return packets[0];for(var i=0,l=packets.length;i<l;i++){var packet=packets[i];decoded+="\ufffd"+packet.length+"\ufffd"+packets[i]}return decoded};var regexp=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;parser.decodePacket=function(data){var pieces=data.match(regexp);if(!pieces)return{};var id=pieces[2]||"",data=pieces[5]||"",packet={type:packets[pieces[1]],endpoint:pieces[4]||""};id&&(packet.id=id,pieces[3]?packet.ack="data":packet.ack=!0);switch(packet.type){case"error":var pieces=data.split("+");packet.reason=reasons[pieces[0]]||"",packet.advice=advice[pieces[1]]||"";break;case"message":packet.data=data||"";break;case"event":try{var opts=JSON.parse(data);packet.name=opts.name,packet.args=opts.args}catch(e){}packet.args=packet.args||[];break;case"json":try{packet.data=JSON.parse(data)}catch(e){}break;case"connect":packet.qs=data||"";break;case"ack":var pieces=data.match(/^([0-9]+)(\+)?(.*)/);if(pieces){packet.ackId=pieces[1],packet.args=[];if(pieces[3])try{packet.args=pieces[3]?JSON.parse(pieces[3]):[]}catch(e){}}break;case"disconnect":case"heartbeat":}return packet},parser.decodePayload=function(data){if(data.charAt(0)=="\ufffd"){var ret=[];for(var i=1,length="";i<data.length;i++)data.charAt(i)=="\ufffd"?(ret.push(parser.decodePacket(data.substr(i+1).substr(0,length))),i+=Number(length)+1,length=""):length+=data.charAt(i);return ret}return[parser.decodePacket(data)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io){function Transport(socket,sessid){this.socket=socket,this.sessid=sessid}exports.Transport=Transport,io.util.mixin(Transport,io.EventEmitter),Transport.prototype.heartbeats=function(){return!0},Transport.prototype.onData=function(data){this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(data!==""){var msgs=io.parser.decodePayload(data);if(msgs&&msgs.length)for(var i=0,l=msgs.length;i<l;i++)this.onPacket(msgs[i])}return this},Transport.prototype.onPacket=function(packet){return this.socket.setHeartbeatTimeout(),packet.type=="heartbeat"?this.onHeartbeat():(packet.type=="connect"&&packet.endpoint==""&&this.onConnect(),packet.type=="error"&&packet.advice=="reconnect"&&(this.isOpen=!1),this.socket.onPacket(packet),this)},Transport.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var self=this;this.closeTimeout=setTimeout(function(){self.onDisconnect()},this.socket.closeTimeout)}},Transport.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},Transport.prototype.onConnect=function(){return this.socket.onConnect(),this},Transport.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},Transport.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},Transport.prototype.packet=function(packet){this.send(io.parser.encodePacket(packet))},Transport.prototype.onHeartbeat=function(heartbeat){this.packet({type:"heartbeat"})},Transport.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},Transport.prototype.onClose=function(){var self=this;this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},Transport.prototype.prepareUrl=function(){var options=this.socket.options;return this.scheme()+"://"+options.host+":"+options.port+"/"+options.resource+"/"+io.protocol+"/"+this.name+"/"+this.sessid},Transport.prototype.ready=function(socket,fn){fn.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function Socket(options){this.options={port:80,secure:!1,document:"document"in global?document:!1,resource:"socket.io",transports:io.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843,manualFlush:!1},io.util.merge(this.options,options),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||io.util.ua.hasCORS)){var self=this;io.util.on(global,"beforeunload",function(){self.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function empty(){}exports.Socket=Socket,io.util.mixin(Socket,io.EventEmitter),Socket.prototype.of=function(name){return this.namespaces[name]||(this.namespaces[name]=new io.SocketNamespace(this,name),name!==""&&this.namespaces[name].packet({type:"connect"})),this.namespaces[name]},Socket.prototype.publish=function(){this.emit.apply(this,arguments);var nsp;for(var i in this.namespaces)this.namespaces.hasOwnProperty(i)&&(nsp=this.of(i),nsp.$emit.apply(nsp,arguments))},Socket.prototype.handshake=function(fn){function complete(data){data instanceof Error?(self.connecting=!1,self.onError(data.message)):fn.apply(null,data.split(":"))}var self=this,options=this.options,url=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,io.protocol,io.util.query(this.options.query,"t="+ +(new Date))].join("/");if(this.isXDomain()&&!io.util.ua.hasCORS){var insertAt=document.getElementsByTagName("script")[0],script=document.createElement("script");script.src=url+"&jsonp="+io.j.length,insertAt.parentNode.insertBefore(script,insertAt),io.j.push(function(data){complete(data),script.parentNode.removeChild(script)})}else{var xhr=io.util.request();xhr.open("GET",url,!0),xhr.withCredentials=!0,xhr.onreadystatechange=function(){xhr.readyState==4&&(xhr.onreadystatechange=empty,xhr.status==200?complete(xhr.responseText):xhr.status==403?self.onError(xhr.responseText):(self.connecting=!1,!self.reconnecting&&self.onError(xhr.responseText)))},xhr.send(null)}},Socket.prototype.getTransport=function(override){var transports=override||this.transports,match;for(var i=0,transport;transport=transports[i];i++)if(io.Transport[transport]&&io.Transport[transport].check(this)&&(!this.isXDomain()||io.Transport[transport].xdomainCheck(this)))return new io.Transport[transport](this,this.sessionid);return null},Socket.prototype.connect=function(fn){if(this.connecting)return this;var self=this;return self.connecting=!0,this.handshake(function(sid,heartbeat,close,transports){function connect(transports){self.transport&&self.transport.clearTimeouts(),self.transport=self.getTransport(transports);if(!self.transport)return self.publish("connect_failed");self.transport.ready(self,function(){self.connecting=!0,self.publish("connecting",self.transport.name),self.transport.open(),self.options["connect timeout"]&&(self.connectTimeoutTimer=setTimeout(function(){if(!self.connected){self.connecting=!1;if(self.options["try multiple transports"]){var remaining=self.transports;while(remaining.length>0&&remaining.splice(0,1)[0]!=self.transport.name);remaining.length?connect(remaining):self.publish("connect_failed")}}},self.options["connect timeout"]))})}self.sessionid=sid,self.closeTimeout=close*1e3,self.heartbeatTimeout=heartbeat*1e3,self.transports||(self.transports=self.origTransports=transports?io.util.intersect(transports.split(","),self.options.transports):self.options.transports),self.setHeartbeatTimeout(),connect(self.transports),self.once("connect",function(){clearTimeout(self.connectTimeoutTimer),fn&&typeof fn=="function"&&fn()})}),this},Socket.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var self=this;this.heartbeatTimeoutTimer=setTimeout(function(){self.transport.onClose()},this.heartbeatTimeout)},Socket.prototype.packet=function(data){return this.connected&&!this.doBuffer?this.transport.packet(data):this.buffer.push(data),this},Socket.prototype.setBuffer=function(v){this.doBuffer=v,!v&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},Socket.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},Socket.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this},Socket.prototype.disconnectSync=function(){var xhr=io.util.request(),uri=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,io.protocol,"",this.sessionid].join("/")+"/?disconnect=1";xhr.open("GET",uri,!1),xhr.send(null),this.onDisconnect("booted")},Socket.prototype.isXDomain=function(){var port=global.location.port||("https:"==global.location.protocol?443:80);return this.options.host!==global.location.hostname||this.options.port!=port},Socket.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},Socket.prototype.onOpen=function(){this.open=!0},Socket.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},Socket.prototype.onPacket=function(packet){this.of(packet.endpoint).onPacket(packet)},Socket.prototype.onError=function(err){err&&err.advice&&err.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",err&&err.reason?err.reason:err)},Socket.prototype.onDisconnect=function(reason){var wasConnected=this.connected,wasConnecting=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1;if(wasConnected||wasConnecting)this.transport.close(),this.transport.clearTimeouts(),wasConnected&&(this.publish("disconnect",reason),"booted"!=reason&&this.options.reconnect&&!this.reconnecting&&this.reconnect())},Socket.prototype.reconnect=function(){function reset(){if(self.connected){for(var i in self.namespaces)self.namespaces.hasOwnProperty(i)&&""!==i&&self.namespaces[i].packet({type:"connect"});self.publish("reconnect",self.transport.name,self.reconnectionAttempts)}clearTimeout(self.reconnectionTimer),self.removeListener("connect_failed",maybeReconnect),self.removeListener("connect",maybeReconnect),self.reconnecting=!1,delete self.reconnectionAttempts,delete self.reconnectionDelay,delete self.reconnectionTimer,delete self.redoTransports,self.options["try multiple transports"]=tryMultiple}function maybeReconnect(){if(!self.reconnecting)return;if(self.connected)return reset();if(self.connecting&&self.reconnecting)return self.reconnectionTimer=setTimeout(maybeReconnect,1e3);self.reconnectionAttempts++>=maxAttempts?self.redoTransports?(self.publish("reconnect_failed"),reset()):(self.on("connect_failed",maybeReconnect),self.options["try multiple transports"]=!0,self.transports=self.origTransports,self.transport=self.getTransport(),self.redoTransports=!0,self.connect()):(self.reconnectionDelay<limit&&(self.reconnectionDelay*=2),self.connect(),self.publish("reconnecting",self.reconnectionDelay,self.reconnectionAttempts),self.reconnectionTimer=setTimeout(maybeReconnect,self.reconnectionDelay))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var self=this,maxAttempts=this.options["max reconnection attempts"],tryMultiple=this.options["try multiple transports"],limit=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(maybeReconnect,this.reconnectionDelay),this.on("connect",maybeReconnect)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io){function SocketNamespace(socket,name){this.socket=socket,this.name=name||"",this.flags={},this.json=new Flag(this,"json"),this.ackPackets=0,this.acks={}}function Flag(nsp,name){this.namespace=nsp,this.name=name}exports.SocketNamespace=SocketNamespace,io.util.mixin(SocketNamespace,io.EventEmitter),SocketNamespace.prototype.$emit=io.EventEmitter.prototype.emit,SocketNamespace.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},SocketNamespace.prototype.packet=function(packet){return packet.endpoint=this.name,this.socket.packet(packet),this.flags={},this},SocketNamespace.prototype.send=function(data,fn){var packet={type:this.flags.json?"json":"message",data:data};return"function"==typeof fn&&(packet.id=++this.ackPackets,packet.ack=!0,this.acks[packet.id]=fn),this.packet(packet)},SocketNamespace.prototype.emit=function(name){var args=Array.prototype.slice.call(arguments,1),lastArg=args[args.length-1],packet={type:"event",name:name};return"function"==typeof lastArg&&(packet.id=++this.ackPackets,packet.ack="data",this.acks[packet.id]=lastArg,args=args.slice(0,args.length-1)),packet.args=args,this.packet(packet)},SocketNamespace.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},SocketNamespace.prototype.onPacket=function(packet){function ack(){self.packet({type:"ack",args:io.util.toArray(arguments),ackId:packet.id})}var self=this;switch(packet.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(packet.reason||"booted"):this.$emit("disconnect",packet.reason);break;case"message":case"json":var params=["message",packet.data];packet.ack=="data"?params.push(ack):packet.ack&&this.packet({type:"ack",ackId:packet.id}),this.$emit.apply(this,params);break;case"event":var params=[packet.name].concat(packet.args);packet.ack=="data"&&params.push(ack),this.$emit.apply(this,params);break;case"ack":this.acks[packet.ackId]&&(this.acks[packet.ackId].apply(this,packet.args),delete this.acks[packet.ackId]);break;case"error":packet.advice?this.socket.onError(packet):packet.reason=="unauthorized"?this.$emit("connect_failed",packet.reason):this.$emit("error",packet.reason)}},Flag.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},Flag.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function WS(socket){io.Transport.apply(this,arguments)}exports.websocket=WS,io.util.inherit(WS,io.Transport),WS.prototype.name="websocket",WS.prototype.open=function(){var query=io.util.query(this.socket.options.query),self=this,Socket;return Socket||(Socket=global.MozWebSocket||global.WebSocket),this.websocket=new Socket(this.prepareUrl()+query),this.websocket.onopen=function(){self.onOpen(),self.socket.setBuffer(!1)},this.websocket.onmessage=function(ev){self.onData(ev.data)},this.websocket.onclose=function(){self.onClose(),self.socket.setBuffer(!0)},this.websocket.onerror=function(e){self.onError(e)},this},io.util.ua.iDevice?WS.prototype.send=function(data){var self=this;return setTimeout(function(){self.websocket.send(data)},0),this}:WS.prototype.send=function(data){return this.websocket.send(data),this},WS.prototype.payload=function(arr){for(var i=0,l=arr.length;i<l;i++)this.packet(arr[i]);return this},WS.prototype.close=function(){return this.websocket.close(),this},WS.prototype.onError=function(e){this.socket.onError(e)},WS.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},WS.check=function(){return"WebSocket"in global&&!("__addTask"in WebSocket)||"MozWebSocket"in global},WS.xdomainCheck=function(){return!0},io.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io,global){function XHR(socket){if(!socket)return;io.Transport.apply(this,arguments),this.sendBuffer=[]}function empty(){}exports.XHR=XHR,io.util.inherit(XHR,io.Transport),XHR.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},XHR.prototype.payload=function(payload){var msgs=[];for(var i=0,l=payload.length;i<l;i++)msgs.push(io.parser.encodePacket(payload[i]));this.send(io.parser.encodePayload(msgs))},XHR.prototype.send=function(data){return this.post(data),this},XHR.prototype.post=function(data){function stateChange(){this.readyState==4&&(this.onreadystatechange=empty,self.posting=!1,this.status==200?self.socket.setBuffer(!1):self.onClose())}function onload(){this.onload=empty,self.socket.setBuffer(!1)}var self=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),global.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=onload:this.sendXHR.onreadystatechange=stateChange,this.sendXHR.send(data)},XHR.prototype.close=function(){return this.onClose(),this},XHR.prototype.request=function(method){var req=io.util.request(this.socket.isXDomain()),query=io.util.query(this.socket.options.query,"t="+ +(new Date));req.open(method||"GET",this.prepareUrl()+query,!0);if(method=="POST")try{req.setRequestHeader?req.setRequestHeader("Content-type","text/plain;charset=UTF-8"):req.contentType="text/plain"}catch(e){}return req},XHR.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},XHR.check=function(socket,xdomain){try{var request=io.util.request(xdomain),usesXDomReq=global.XDomainRequest&&request instanceof XDomainRequest,socketProtocol=socket&&socket.options&&socket.options.secure?"https:":"http:",isXProtocol=socketProtocol!=global.location.protocol;if(request&&(!usesXDomReq||!isXProtocol))return!0}catch(e){}return!1},XHR.xdomainCheck=function(socket){return XHR.check(socket,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io){function HTMLFile(socket){io.Transport.XHR.apply(this,arguments)}exports.htmlfile=HTMLFile,io.util.inherit(HTMLFile,io.Transport.XHR),HTMLFile.prototype.name="htmlfile",HTMLFile.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var iframeC=this.doc.createElement("div");iframeC.className="socketio",this.doc.body.appendChild(iframeC),this.iframe=this.doc.createElement("iframe"),iframeC.appendChild(this.iframe);var self=this,query=io.util.query(this.socket.options.query,"t="+ +(new Date));this.iframe.src=this.prepareUrl()+query,io.util.on(window,"unload",function(){self.destroy()})},HTMLFile.prototype._=function(data,doc){this.onData(data);try{var script=doc.getElementsByTagName("script")[0];script.parentNode.removeChild(script)}catch(e){}},HTMLFile.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},HTMLFile.prototype.close=function(){return this.destroy(),io.Transport.XHR.prototype.close.call(this)},HTMLFile.check=function(socket){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window)try{var a=new(window[["Active"].concat("Object").join("X")])("htmlfile");return a&&io.Transport.XHR.check(socket)}catch(e){}return!1},HTMLFile.xdomainCheck=function(){return!1},io.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function XHRPolling(){io.Transport.XHR.apply(this,arguments)}function empty(){}exports["xhr-polling"]=XHRPolling,io.util.inherit(XHRPolling,io.Transport.XHR),io.util.merge(XHRPolling,io.Transport.XHR),XHRPolling.prototype.name="xhr-polling",XHRPolling.prototype.heartbeats=function(){return!1},XHRPolling.prototype.open=function(){var self=this;return io.Transport.XHR.prototype.open.call(self),!1},XHRPolling.prototype.get=function(){function stateChange(){this.readyState==4&&(this.onreadystatechange=empty,this.status==200?(self.onData(this.responseText),self.get()):self.onClose())}function onload(){this.onload=empty,this.onerror=empty,self.onData(this.responseText),self.get()}function onerror(){self.onClose()}if(!this.isOpen)return;var self=this;this.xhr=this.request(),global.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=onload,this.xhr.onerror=onerror):this.xhr.onreadystatechange=stateChange,this.xhr.send(null)},XHRPolling.prototype.onClose=function(){io.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=empty;try{this.xhr.abort()}catch(e){}this.xhr=null}},XHRPolling.prototype.ready=function(socket,fn){var self=this;io.util.defer(function(){fn.call(self)})},io.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io,global){function JSONPPolling(socket){io.Transport["xhr-polling"].apply(this,arguments),this.index=io.j.length;var self=this;io.j.push(function(msg){self._(msg)})}var indicator=global.document&&"MozAppearance"in global.document.documentElement.style;exports["jsonp-polling"]=JSONPPolling,io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]),JSONPPolling.prototype.name="jsonp-polling",JSONPPolling.prototype.post=function(data){function complete(){initIframe(),self.socket.setBuffer(!1)}function initIframe(){self.iframe&&self.form.removeChild(self.iframe);try{iframe=document.createElement('<iframe name="'+self.iframeId+'">')}catch(e){iframe=document.createElement("iframe"),iframe.name=self.iframeId}iframe.id=self.iframeId,self.form.appendChild(iframe),self.iframe=iframe}var self=this,query=io.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="socketio_iframe_"+this.index,iframe;form.className="socketio",form.style.position="absolute",form.style.top="0px",form.style.left="0px",form.style.display="none",form.target=id,form.method="POST",form.setAttribute("accept-charset","utf-8"),area.name="d",form.appendChild(area),document.body.appendChild(form),this.form=form,this.area=area}this.form.action=this.prepareUrl()+query,initIframe(),this.area.value=io.JSON.stringify(data);try{this.form.submit()}catch(e){}this.iframe.attachEvent?iframe.onreadystatechange=function(){self.iframe.readyState=="complete"&&complete()}:this.iframe.onload=complete,this.socket.setBuffer(!0)},JSONPPolling.prototype.get=function(){var self=this,script=document.createElement("script"),query=io.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),script.async=!0,script.src=this.prepareUrl()+query,script.onerror=function(){self.onClose()};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt),this.script=script,indicator&&setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe),document.body.removeChild(iframe)},100)},JSONPPolling.prototype._=function(msg){return this.onData(msg),this.isOpen&&this.get(),this},JSONPPolling.prototype.ready=function(socket,fn){var self=this;if(!indicator)return fn.call(this);io.util.load(function(){fn.call(self)})},JSONPPolling.check=function(){return"document"in global},JSONPPolling.xdomainCheck=function(){return!0},io.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this)})(),function(debuggify,undefined){var transports=debuggify.Transports,websockets=transports.Websockets=transports.Websockets||function(w,d,extend,globals,transports){function Websocket(options){options=options||{};var self=this;self.defaults={level:0,timestamp:!0,host:"localhost",port:"9999",prefix:"debuggify",agent:"client",publish:"logger",subscribe:null,onMessage:null},self.options=extend(options,self.defaults),self.initialize(self.options.level,self.options.timestamp),self.options.hostname="http://"+self.options.host+":"+self.options.port;var info=sockets_[self.options.hostname]={status:!1,isRegistered:!1,autoReconnect:!0,verbose:!1,reconnectAttempts:0,maxReconnectAttemps:10,socket:null},socket=info.socket=io.connect(self.options.hostname)||io.connect("http://localhost:4000");self.socket=socket,self.info=info,socket.on("connect",function(){info.status=!0,self.register(),self.subscribe(self.options.subscribe)}),socket.on("disconnect",function(){info.status=!1,info.isRegistered=!1,info.autoReconnect&&!info.autoReconnect&&info.maxReconnectAttemps>info.reconnectAttempts&&(maxReconnectAttemps+=1,info.socket.connect())}),socket.on("message",function(packet){var data=packet.data;switch(data.cmd){case"reload":d.location.href=d.location.href;break;default:typeof self.options.onMessage=="function"&&self.options.onMessage(packet)}}),self.socket=sockets_[self.options.hostname]}var sockets_={},delimiter="_";return Websocket.prototype=new transports("Websockets"),Websocket.prototype.register=function(message,info){this.info.isRegistered||(this.socket.socket.json.emit("register",{prefix:this.options.prefix,agent:"client"}),this.info.isRegistered=!0)},Websocket.prototype.send=function(message,info){info.message=message,this.publish(info)},Websocket.prototype.subscribe=function(channel){if(!channel)return!1;var self=this,options=self.options,socket=self.socket.socket;return socket.emit("subscribe",{channel:channel}),!0},Websocket.prototype.publish=function(data,channel){var self=this,options=self.options,socket=self.socket.socket;return self.register(),channel=channel||options.publish,channel?socket.json.emit("publish",{channel:channel,data:data}):!1},Websocket.prototype.sendTo=function(data,to){var self=this,socket=self.socket.socket;return to?socket.json.emit("publish",{to:to,data:data}):!1},Websocket.prototype.serviceUrl=function(){if(w.remoteJsServiceUrl)return w.remoteJsServiceUrl;var script,scripts=d.getElementsByTagName("script");for(var i in scripts){script=scripts[i].src;if(script&&script.match("/client.js"))break}if(!script){var msg="Could not find window.remoteJsServiceUrl try setting it explicitly";throw new Error(msg)}return script.replace("/client.js","/")},Websocket.prototype.loadScript=function(src,loadCallback){var script=d.createElement("script");script.src=src,script.type="text/javascript",loadCallback&&(script.onload=loadCallback),d.getElementsByTagName("head")[0].appendChild(script)},Websocket}(debuggify.win,debuggify.doc,debuggify.extend,debuggify.globals,transports)}(debuggify)